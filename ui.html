<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: sans-serif;
      padding: 10px;
    }
    textarea {
      width: 100%;
      height: 300px;
      font-family: monospace;
      resize: none;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <h3>Extract Text to JSON</h3>
  <p>Select a node and click below to export its text layers as JSON.</p>
  <button id="extract">Extract Text</button>
  <div id="output"></div>

  <script>
    const button = document.getElementById('extract');
    const output = document.getElementById('output');

    button.onclick = () => {
      parent.postMessage({ pluginMessage: { type: 'extract-texts' } }, '*');
    };

    onmessage = (event) => {
      const msg = event.data.pluginMessage;

      if (msg.type === 'error') {
        output.innerHTML = `<p class="error">${msg.message}</p>`;
      } else if (msg.type === 'text-json') {
        const json = JSON.stringify(msg.data, null, 2);
        output.innerHTML = `
          <p>Found ${msg.data.length} text layers:</p>
          <textarea readonly>${json}</textarea>
        `;
      }
    };
  </script>
</body>
</html>
